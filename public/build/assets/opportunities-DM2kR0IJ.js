import{r as l,j as e,J as p}from"./app-CxGGjgSA.js";import{F as r,c as j,m as g,n as N,o as b,l as v,p as u,q as y,r as _}from"./index.es-DJ11ztjN.js";import{g as w,u as O}from"./opportunities-api-service-ChV8Yhew.js";import P from"./error-page-YirL9gZz.js";/* empty css            */const k=()=>{const[c,o]=l.useState([]),[m,d]=l.useState(!0),[x,i]=l.useState(null);l.useEffect(()=>{(async()=>{d(!0),i(null);try{const a=await w();o(a.data.map(t=>{var n;return{id:t.id,title:t.title,client_id:((n=t.client_id)==null?void 0:n.toString())||"",value:t.value,status:t.status,client:{id:t.client.id,first_name:t.client.first_name,last_name:t.client.last_name,email:t.client.email,phone:t.client.phone,address:t.client.address,company_name:t.client.company_name,created_at:t.client.created_at,updated_at:t.client.updated_at}}}))}catch(a){console.error("Error fetching opportunities:",a),i("Failed to load opportunities.")}finally{d(!1)}})()},[]);const h={Open:u,"In Progress":y,Won:u,Lost:v},f=async(s,a)=>{const t=s.target.value;o(c.map(n=>n.id===a?{...n,status:t}:n));try{await O(a,{status:t})}catch(n){console.error(`Failed to update opportunity ${a} status:`,n),i(`Failed to update opportunity ${a} status.`)}};return m?e.jsx("div",{children:"Loading opportunities..."}):x?e.jsx(P,{}):e.jsx("div",{className:"min-h-screen bg-gray-100 px-4 py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"mx-auto max-w-3xl",children:[e.jsxs(p,{href:"/dashboard",className:"mb-4 inline-flex items-center font-semibold text-blue-600 hover:underline",children:[e.jsx(r,{icon:j,className:"mr-2"})," Back to Dashboard"]}),e.jsx("h2",{className:"mb-6 text-2xl font-bold text-gray-900",children:"Oportunidades"}),e.jsx("div",{className:"space-y-4",children:c.map(s=>e.jsxs("div",{className:"relative overflow-hidden rounded-md bg-white shadow",children:[e.jsxs("div",{className:"px-4 py-5 sm:p-6",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:s.title}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:[e.jsxs("span",{className:"mb-1 block",children:[e.jsx(r,{icon:g,className:"mr-1"})," Cliente:"," ",e.jsxs(p,{href:`/clients?email=${encodeURI(s.client.email)}`,className:"text-blue-800",children:[s.client.first_name," ",s.client.last_name]})]}),e.jsxs("span",{className:"mb-1 block",children:[e.jsx(r,{icon:N})," TelÃ©fono: ",s.client.phone]}),e.jsxs("span",{className:"mb-1 block",children:[e.jsx(r,{icon:b,className:"mr-1"})," Valor: ",s.value]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(r,{icon:h[s.status],className:"mr-1"})," Estado:",e.jsx("span",{className:s.status==="Open"?"ml-1 text-green-500":s.status==="In Progress"?"ml-1 text-yellow-600":s.status==="Won"?"ml-1 text-green-700":s.status==="Lost"?"ml-1 text-red-700":"ml-1 text-gray-500",children:s.status}),e.jsxs("div",{className:"relative ml-2",children:[e.jsx(r,{icon:_,className:"cursor-pointer text-blue-600"}),e.jsxs("select",{value:s.status,onChange:a=>f(a,s.id),className:"absolute top-0 left-0 w-full cursor-pointer opacity-0",children:[e.jsx("option",{value:"Open",children:"Abierta"}),e.jsx("option",{value:"In Progress",children:"En progreso"}),e.jsx("option",{value:"Won",children:"Ganada"}),e.jsx("option",{value:"Lost",children:"Perdida"})]})]})]})]})]}),s.status!=="Open"&&s.status!=="In Progress"&&e.jsx("div",{className:"absolute top-2 right-2 flex space-x-2",children:s.status==="Won"?e.jsx("span",{className:"rounded bg-green-500 px-4 py-2 text-sm font-bold text-white",children:"Venta"}):s.status==="Lost"?e.jsx("span",{className:"rounded bg-red-500 px-4 py-2 text-sm font-bold text-white",children:"Perdida"}):null})]},s.id))})]})})};export{k as default};
